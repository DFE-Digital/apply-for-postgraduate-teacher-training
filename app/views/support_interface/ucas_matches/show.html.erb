<% content_for :context, "UCAS match" %>
<% content_for :title, @match.candidate.email_address %>
<% content_for :browser_title, "UCAS match: #{@match.candidate.email_address}" %>

<% content_for :before_content do %>
  <%= render BreadcrumbComponent.new(items: [
    {
      text: 'Candidates',
      path: support_interface_candidates_path
    },
    {
      text: 'UCAS matches',
      path: support_interface_ucas_matches_path
    },
    {
      text: @match.candidate.email_address
    }
  ]) %>
<% end %>

<h2 class="govuk-heading-m govuk-!-font-size-27 govuk-!-margin-top-8">Application</h2>
<% application = @match.candidate.application_forms.first %>

<%= render SummaryListComponent.new(rows: {
  'Candidate name' => "#{application.first_name} #{application.last_name}",
  'Candidate email' => @match.candidate.email_address.to_s,
  'Last updated' => @match.updated_at.to_s(:govuk_date_and_time),
  'Status' => render(TagComponent.new(text: @match.matching_state.humanize, type: @match.processed? ? :green : :purple)),
  'Application on Apply' => govuk_link_to('View application', support_interface_application_form_path(application)),
}) %>

<% unless @match.processed? %>
  <%= form_with url: support_interface_process_match_path(@match), method: :post do |f| %>
    <%= f.submit 'Mark as processed', class: 'govuk-button govuk-!-margin-bottom-0' %>
  <% end %>
<% end %>

<h2 class="govuk-heading-m govuk-!-font-size-27 govuk-!-margin-top-8">Course choices</h2>
<%= render SupportInterface::UCASMatchTableComponent.new(@match) %>

<h2 class="govuk-heading-m govuk-!-font-size-27 govuk-!-margin-top-8">Matched courses</h2>
<% @match.matching_data.each do |matching_datum| %>
  <%= render SummaryCardComponent.new(rows: matching_datum) %>
<% end %>

<h2 class="govuk-heading-m govuk-!-font-size-27 govuk-!-margin-top-8">History</h2>
<%= render SupportInterface::AuditTrailComponent.new(audited_thing: @match) %>
