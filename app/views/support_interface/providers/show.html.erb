<% content_for :title, @provider.name_and_code %>
<% content_for :before_content, govuk_back_link_to(support_interface_providers_path, 'Back to providers') %>

<%= render(SupportInterface::ProviderSyncCoursesToggleComponent.new(provider: @provider)) %>

<% if @provider.courses.any? %>
  <%= form_with model: @provider, url: support_interface_provider_path(@provider), method: :post do |f| %>
    <h3 class="govuk-heading-m">
      Data Sharing Agreement
    </h3>

    <p class="govuk-body">
      <% if @provider_agreement %>
        Accepted by <strong>
        <%= @provider_agreement.provider_user.email_address %>
        </strong>
        on
        <%= @provider_agreement.accepted_at.to_s(:govuk_date) %>.
      <% else %>
        No data sharing agreement has been accepted yet.
      <% end %>
    </p>

    <h3 class="govuk-heading-m">
      Open all courses
    </h3>

    <p class="govuk-body">This will toggle every course on this provider to be available through Apply.</p>

    <%= f.govuk_submit "Open #{pluralize(@provider.courses.size, 'course')}" %>
  <% end %>
<% end %>

<h2 class='govuk-heading-l'>Offers <%= pluralize(@provider.courses.size, 'course') %> (<%= @provider.courses.open_on_apply.size %> on DfE Apply)</h2>
<%= render(SupportInterface::ProviderCoursesTableComponent.new(provider: @provider, courses: @provider.courses.includes(:accrediting_provider))) %>

<% if @provider.accredited_courses.any? %>
  <h2 class='govuk-heading-l'>Accredits <%= pluralize(@provider.accredited_courses.size, 'course') %> (<%= @provider.accredited_courses.open_on_apply.size %> on DfE Apply)</h2>
  <%= render(SupportInterface::ProviderCoursesTableComponent.new(provider: @provider, courses: @provider.accredited_courses)) %>
<% end %>

<h2 class='govuk-heading-l'>Course choices & vacancies</h2>
<%= render(SupportInterface::CourseChoicesTableComponent.new(course_options: @course_options)) %>

<h2 class='govuk-heading-l'>Sites (<%= @provider.sites.size %>)</h2>

<table class='govuk-table'>
  <thead class='govuk-table__head'>
    <tr class='govuk-table__row'>
      <th scope='col' class='govuk-table__header'>Name</th>
      <th scope='col' class='govuk-table__header'>Address</th>
    </tr>
  </thead>

  <tbody class='govuk-table__body'>
    <% @provider.sites.each do |site| %>
      <tr class='govuk-table__row'>
        <td class='govuk-table__cell'><%= site.name_and_code %></td>
        <td class='govuk-table__cell'><%= site.full_address %></td>
      </tr>
    <% end %>
  </tbody>
</table>
