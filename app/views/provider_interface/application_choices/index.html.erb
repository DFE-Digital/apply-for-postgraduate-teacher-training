<% content_for :browser_title, 'Applications' %>

<% if FeatureFlag.active?('covid_19') %>
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <div class="app-banner" aria-labelledby="covid-message" data-module="govuk-error-summary" role="alert">
        <div class="app-banner__message">
          <h2 class="govuk-heading-m" id="covid-message">
            <%= link_to 'Coronavirus (COVID-19): check our guidance to see new deadlines for processing applications',
              provider_interface_covid_19_guidance_path,
              class: 'govuk-link'
            %>
          </h2>
        </div>
      </div>
    </div>
  </div>
<% end %>

<% if FeatureFlag.active?('getting_ready_for_next_cycle_banner') %>
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <div class="app-banner" aria-labelledby="getting-ready-for-next-cycle-message">
        <div class="app-banner__message">
          <h2 class="govuk-heading-m" id="getting-ready-for-next-cycle-message">
            <%= govuk_link_to(
              'Getting ready for the next cycle: important dates and our plans for a smooth transition',
              provider_interface_getting_ready_for_next_cycle_path,
              class: 'govuk-link--no-visited-state',
            ) %>
          </h2>
        </div>
      </div>
    </div>
  </div>
<% end %>

<h1 class='govuk-heading-xl'>Applications</h1>

<div class='moj-filter-layout'>
  <%= render ProviderInterface::FilterComponent.new(page_state: @page_state) %>
  <div class='moj-filter-layout__content'>
    <% if @application_choices.any? %>
      <div class="app-application-cards">
        <% previous_header = '' %>
        <% @application_choices.each_with_index do |choice, index| %>
          <% group_header = task_view_header choice %>
          <% if group_header != previous_header %>
            <h2 class='govuk-heading-m task_view_group_header'>
              <%= group_header %>
            </h2>
            <% previous_header = group_header %>
          <% end %>
          <%= render ProviderInterface::ApplicationCardComponent.new(application_choice: choice, show_date: @page_state.sort_by) %>
        <% end %>
      </div>
    <% elsif @page_state.filtered? %>
      <p class='govuk-body'>No applications for the selected filters.</p>
    <% else %>
      <p class='govuk-body'>You have not received any applications from <%= t('service_name.apply') %>.</p>
    <% end %>
    <%= render(PaginatorComponent.new(scope: @application_choices)) %>
  </div>
</div>
