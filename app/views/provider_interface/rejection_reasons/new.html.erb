<%= form_with model: @reasons_form, url: provider_interface_rejection_reasons_path do |f| %>
  <%= f.govuk_error_summary %>

  <%= render "hidden_fields", f: f %>

  <% @reasons_form.questions.each do |q| %>
    <%= f.fields_for :questions, q do |qf| %>
      <%= qf.govuk_radio_buttons_fieldset :y_or_n, legend: { text: q.label } do %>
        <%= qf.hidden_field :label %>
        <%= qf.hidden_field :additional_question %>
        <%= qf.govuk_radio_button :y_or_n, 'Y', label: { text: 'Yes' } do %>
          <legend class="govuk-fieldset__legend govuk-fieldset__legend--s">
            <%= q.additional_question %>
          </legend>
          <% q.reasons.each do |r| %>
            <%= qf.fields_for :reasons, r do |rf| %>
              <%= rf.hidden_field :label %>
              <% if q.additional_question.present? %>
                <%= rf.govuk_check_boxes_fieldset :value, small: true do %>
                  <% if r.textareas.any? %>
                    <%= rf.govuk_check_box :value, 'true', multiple: false, label: { text: r.label } do %>
                      <%= render 'textareas', reasons_fields: rf, textareas: r.textareas %>
                    <% end %>
                  <% else %>
                    <%= rf.govuk_check_box :value, 'true', multiple: false, label: { text: r.label } %>
                  <% end %>
                <% end %>
              <% else %>
                <%= rf.hidden_field :value, value: 'true' %>
                <%= render 'textareas', reasons_fields: rf, textareas: r.textareas %>
              <% end %>
            <% end %>
          <% end %>
        <% end %>
        <%= qf.govuk_radio_button :y_or_n, 'N', label: { text: 'No' }  %>
      <% end %>
    <% end %>
  <% end %>

  <%= f.submit %>
<% end %>
