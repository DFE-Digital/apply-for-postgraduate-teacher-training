<% content_for :title, t('page_titles.references') %>
<% content_for :before_content, govuk_back_link_to(candidate_interface_application_form_path, 'Back to application') %>

<h1 class="govuk-heading-xl">
  <%= t('page_titles.references') %>
</h1>

<%= render CandidateInterface::AddReferenceComponent.new(@application_form) %>
<% if @too_many_references %>
  <div class="govuk-error-summary" tabindex="-1" role="alert" data-module="govuk-error-summary" aria-labelledby="error-summary-title">
    <h2 id="error-summary-title" class="govuk-error-summary__title">
      There is a problem
    </h2>
    <div class="govuk-error-summary__body">
      <ul class="govuk-list govuk-error-summary__list">
        <li><%= link_to t('application_form.references.review.too_many'), '#references_given' %></li>
      </ul>
    </div>
  </div>
<% end %>

<% if @references_given.present? %>
  <div id="references_given">
    <h2 class="govuk-heading-m">References that have been given</h2>
    <% review_component = CandidateInterface::ReferencesReviewComponent.new(references: @references_given, show_history: true) %>
    <% if @too_many_references %>
      <div class="govuk-inset-text app-inset-text--error">
        <p class="govuk-heading-s govuk-!-margin-bottom-2"><%= t('application_form.references.review.too_many') %></p>
        <p class="govuk-body"><%= @too_many_references_error %></p>
        <%= render(review_component) %>
      </div>
    <% else %>
        <%= render(review_component) %>
    <% end %>
  </div>
<% end %>

<% if @references_waiting_to_be_sent.present? %>
  <div id="references_waiting_to_be_sent">
    <h2 class="govuk-heading-m">Requests that have not been sent</h2>
    <%= render(CandidateInterface::ReferencesReviewComponent.new(references: @references_waiting_to_be_sent, show_history: true)) %>
  </div>
<% end %>

<% if @references_sent.present? %>
  <div id="references_sent">
    <h2 class="govuk-heading-m">Reference requests</h2>
    <%= render(CandidateInterface::ReferencesReviewComponent.new(references: @references_sent, editable: false, show_history: true)) %>
  </div>
<% end %>

<%= govuk_link_to 'Continue', candidate_interface_application_form_path, class: 'govuk-button' %>
