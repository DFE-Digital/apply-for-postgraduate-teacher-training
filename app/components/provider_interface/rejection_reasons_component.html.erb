<div class="feedback">
  <% if answered_yes_to_question?('future_applications') %>
   <h2 class="govuk-heading-m">The provider would be interested in future applications from you</h2>
  <% end %>
  <p class="govuk-body">Hereâ€™s why your application was unsuccessful.</p>

  <% renderable_reasons.each do |rr| %>
    <h3 class="govuk-heading-s"><%= t(rr.label.gsub('label', 'feedback')) %></h3>
    <% if rr.additional_question.present? %>
      <ul class="govuk-list">
        <% rr.reasons.each do |r| %>
          <% if r.value.present? %>
          <li><%= t(r.label.gsub('label', 'feedback')) unless r.label.include?('other') %></li>
            <% if r.textareas.any? %>
              <% r.textareas.each do |ta| %>
                <% if ta.value.present? %>
                  <% if ta.label.include?('details') %>
                    <p class="govuk-body">
                      <% unless r.label.include?('other') %>Details: <% end %>
                      <%= ta.value%>
                    </p>
                  <% else %>
                    <p class="govuk-body">Advice: <%= ta.value%></p>
                  <% end %>
                <% end %>
              <% end %>
            <% end %>
          <% end %>
        <% end %>
      </ul>
    <% else %>
      <% if rr.reasons.any? && rr.reasons.map(&:textareas).any? %>
        <p class="govuk-body"><%= rr.reasons.first.textareas.first.value %></p>
      <% end %>
    <% end %>

    <% ['course_is_full', 'offered_them_a_place_on_another_course'].each do |question_key| %>
      <% if rr.answered_yes?(question_key) %>
        <p class="govuk-body"><%= t("rejection_reasons.reasons.#{question_key}.feedback") %></p>
      <% end %>
    <% end %>
  <% end %>

  <% unless answered_yes_to_question?('future_applications') %>
    <h3 class="govuk-heading-s">Future applications</h3>
    <p class="govuk-body">The provider would not be interested in future applications from you.</p>
  <% end %>
</div>
