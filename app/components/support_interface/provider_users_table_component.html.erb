<% if table_rows.any? %>
  <table class="govuk-table">
    <thead class="govuk-table__head">
      <tr class="govuk-table__row">
        <th scope="col" class="govuk-table__header govuk-!-width-one-third">Name and email address</th>
        <th scope="col" class="govuk-table__header">Providers</th>
        <th scope="col" class="govuk-table__header">Last signed in at</th>
      </tr>
    </thead>

    <tbody class="govuk-table__body">
      <% table_rows.each do |row| %>
        <tr class="govuk-table__row">
          <td class="govuk-table__cell">
            <%= govuk_link_to(row[:provider_user].full_name, edit_support_interface_provider_user_path(row[:provider_user])) %><br/>
            <span style='word-break: break-all;'><%= row[:provider_user].email_address %></span>
          </td>
          <td class="govuk-table__cell">
            <% row[:provider_user].provider_permissions.each do |permission| %>
              <div class='govuk-!-margin-bottom-2'>
                <h3 class='govuk-heading-s'><%= permission.provider.name_and_code %></h3>
                <%= render PermissionsList.new(permission, user_is_viewing_their_own_permissions: false) %>
              </div>
            <% end %>
          </td>
          <% if row[:last_signed_in_at] %>
            <td class="govuk-table__cell"><%= row[:last_signed_in_at] %></td>
          <% else %>
            <% if row[:created_at] < Date.new(2019, 12, 25) %>
              <td class="govuk-table__cell"><em>Unknown (records began 24 December 2019)</em></td>
            <% else %>
              <td class="govuk-table__cell"><em>Never signed in</em></td>
            <% end %>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>
